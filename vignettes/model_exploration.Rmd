---
title: "Model Exploration"
output:
  html_document:
    toc: yes
    toc_depth: 3
    code_folding: hide
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(ggplot2)
library(dplyr)
library(knitr)
library(mizerShelf)
```


```{r}
params <- readParams("../inst/params_no_lesueurs.rds")
plotlySpectra(params, resource = FALSE, ylim = c(1e-10, NA))
```

```{r}
target = c("Hake", "Red mullet", "Poor cod","Blue whiting", "Shortfin squid",
           "Horse mackerel", "Angler fish", "Horned octopus")

plotSpectra(params, resource = FALSE, species = target, ylim = c(1e-7, NA))
```

## Change in selectivity

```{r}
# Change selectivity ----
params_s <- NWMed_params
gear_params(params_s)["Hake, Main", c("l25", "l50")] <- c(18, 21.5)
gear_params(params_s)["Red mullet, Main", c("l25", "l50")] <- c(15.13, 17.28)
gear_params(params_s)["Striped red mullet, Main", c("l25", "l50")] <- c(15.13, 17.28)
gear_params(params_s)["Angler fish, Main", c("l25", "l50")] <- c(14, 18)
gear_params(params_s)["Poor cod, Main", c("l25", "l50")] <- c(8.1, 9.5)
gear_params(params_s)["Horse mackerel, Main", c("l25", "l50")] <- c(15.2, 17)
gear_params(params_s)["Blue whiting, Main", c("l25", "l50")] <- c(18.80, 22.25)
gear_params(params_s)["Shortfin squid, Main", c("l25", "l50")] <- c(14.2, 16.5)
gear_params(params_s)["Horned octopus, Main", c("l25", "l50")] <- c(14.20, 16.5)
#gear_params(params_s)["Gurnards, Main", c("l25", "l50")] <- c(16.6, 18.5)
```


```{r}
sim_s <- project(params_s, t_max = 15)
```

```{r}
mizer::plotBiomass(sim_s, species = target)
```

```{r}
yield <- plotYield(sim_s, species = target, return_data = TRUE)
yield_initial <- data.frame(Year = rep(-1, 8),
                            Yield = getYield(params)[target],
                            Species = target)
plotDataFrame(rbind(yield_initial, yield), params)
```

## Discard reduction

```{r}
params_d <- NWMed_params
species_params(params_d)["Hake", "discard"] <- 0
```

```{r}
sim_d <- project(params_d, t_max = 15)
```

```{r}
mizer::plotBiomass(sim_d, species = target)
```

```{r}
plotlyBiomassRelative(sim_d)
```


## Effort reduction

```{r}
sim_e <- project(params, t_max = 15, effort = 0.6)
```

```{r}
mizer::plotBiomass(sim_e, species = target)
```

```{r}
yield <- plotYield(sim_e, species = target, return_data = TRUE)
yield_initial <- data.frame(Year = rep(-1, 8),
                            Yield = getYield(params)[target],
                            Species = target)
plotDataFrame(rbind(yield_initial, yield), params)
```